<body>

  <%= render "app_components/header", right_buttons: [:share_profile, :options_profile] %>

  <%= render("dialog_delivery", profile: @profile) if @profile.delivery.present? %>
  <%= render("dialog_whatsapp", profile: @profile) if @profile.whatsapp.present? %>
  <%= render("dialog_address", address: @profile.address) if @profile.address.present? %>
  <%= render("dialog_horarios") %>
  <%= render("dialog_avatar", image_src: @instagram_scrap[:avatar_url_large] || @profile.avatar_url) %>
  <%= render("action_sheet_statistics", profile: @profile) if current_user? @profile.user %>

  <%= render("app_components/toast_notification", id: "toast-salvar", text: "Salvo na minha lista", color: "primary") %>


  <!-- App Capsule -->
  <div id="appCapsule" class="mt-3 mb-5">

    <div class="section">
      <div class="profile-head">
        <div class="avatar">
          <a href="#" onclick="trackProfile(<%= @profile.id %>, <%= Statistic.events[:foto_click] %>);" data-toggle="modal" data-target="#dialog-avatar">
            <%= image_tag @profile.avatar_url, class: "imaged w64 rounded" %>
          </a>
        </div>
        <div class="in">
          <h3 class="name"><%= @profile.title %></h3>
          <h5 class="subtext"><%= @profile.tagline %></h5>
        </div>
      </div>
    </div>

    <div class="section mt-1">
      <nav class="breadcrumb-sm" aria-label="breadcrumb">
        <a href="#" class="vibrate"><%= @profile.sub_categ.try(:categ).try(:name) || "Categoria" %></a>
        <span>&nbsp;>&nbsp;</span>
        <a href="#" class="vibrate" aria-current="page"><%= @profile.sub_categ.try(:name) || "SubCategoria" %></a>
      </nav>
    </div>

    <div class="section mt-1 mb-2">
      <div class="profile-info">
        <div class="bio">
          <%= add_breaklines(remove_emojis @profile.bio) %>
        </div>
      </div>
    </div>

    <div class="section mt-3">
      <div class="row">
      <% if current_user? @profile.user %>
        <div class="col-6">
          <a href="#">
            <button type="button" class="btn btn-block btn-sm btn-primary vibrate">Editar perfil</button>
          </a>
        </div>
        <div class="col-6">
          <a href="#" data-toggle="modal" data-target="#action-sheet-statistics">
            <button type="button" class="btn btn-block btn-sm btn-outline-primary">Estatísticas</button>
          </a>
        </div>
        <div class="mt-1" style="display: none;">
          <% completion_rate = @profile.completion_rate %>
          <%= progress_bar completion_rate, "Faltam algumas informações no seu perfil", true, "progress-sm" %>
        </div>
      <% else %>
        <% if @profile.whatsapp.present? %>
        <div class="col-6">
          <a href="#" class="btn btn-primary btn-sm btn-block" data-toggle="modal" data-target="#dialog-whatsapp" onclick="trackProfile(<%= @profile.id %>, <%= Statistic.events[:phone_click] %>);">
            <ion-icon name="logo-whatsapp" role="img" class="md hydrated"></ion-icon>
            Mensagem
          </a>
        </div>
        <% end %>
        <div class="col-6">
          <a href="#" class="btn btn-outline-primary btn-sm btn-block vibrate" onclick="toastbox('toast-salvar', 3000);">
            <ion-icon name="heart-outline" role="img" class="md hydrated"></ion-icon>
            Salvar
          </a>
        </div>
      <% end %>
      </div>
    </div>

    <div class="section full mt-3">
      <ul class="listview listview-sm image-listview">
        <% if @profile.whatsapp.present? %>
        <li>
          <a href="#" class="item" data-toggle="modal" data-target="#dialog-whatsapp" onclick="trackProfile(<%= @profile.id %>, <%= Statistic.events[:phone_click] %>);">
            <div class="icon-box">
              <ion-icon name="logo-whatsapp"></ion-icon>
            </div>
            <div class="in">
              <div><%= mask_phone @profile.whatsapp %></div>
              <span class="text-muted">mensagem</span>
            </div>
          </a>
        </li>
        <% end %>
        <% if @profile.address.present? %>
        <li>
        <a href="#" class="item" data-toggle="modal" data-target="#dialog-address" onclick="trackProfile(<%= @profile.id %>, <%= Statistic.events[:address_click] %>);">
            <div class="icon-box">
              <ion-icon name="location-outline"></ion-icon>
            </div>
            <div class="in">
              <div><%= humanize_address @profile.address %></div>
              <span class="text-muted">como chegar</span>
            </div>
          </a>
        </li>
        <% end %>
        <% if @profile.delivery.present? %>
        <li>
          <a href="#" class="item" data-toggle="modal" data-target="#dialog-delivery">
            <div class="icon-box">
              <ion-icon name="bicycle-outline"></ion-icon>
            </div>
            <div class="in">
              <div><%= humanize_delivery_mode @profile.delivery %></div>
              <span class="text-muted">locais de entrega</span>
            </div>
          </a>
        </li>
        <% end %>
        <li>
          <a href="#" class="item" data-toggle="modal" data-target="#dialog-horarios">
            <div class="icon-box">
              <ion-icon name="time-outline"></ion-icon>
            </div>
            <div class="in">
              <div>Aberto hoje - 08h às 20h</div>
              <span class="text-muted">ver horários</span>
            </div>
          </a>
        </li>
        <% if @profile.instagram_account.present? %>
        <li>
          <a href="<%= "https://www.instagram.com/#{@profile.instagram_account.username}" %>" target="_system" class="item" rel="nofollow" onclick="trackProfile(<%= @profile.id %>, <%= Statistic.events[:instagram_click] %>);">
            <div class="icon-box">
              <ion-icon name="logo-instagram"></ion-icon>
            </div>
            <div class="in">
              <div><%= "@#{@profile.instagram_account.username}" %></div>
              <span class="text-muted">instagram</span>
            </div>
          </a>
        </li>
        <% end %>
        <% if @profile.website.present? %>
        <li>
          <a href="<%= mask_url @profile.website %>" target="_blank" class="item" rel="nofollow" onclick="trackProfile(<%= @profile.id %>, <%= Statistic.events[:website_click] %>);">
            <div class="icon-box">
              <ion-icon name="globe-outline"></ion-icon>
            </div>
            <div class="in">
              <div><%= @profile.website %></div>
              <span class="text-muted">website</span>
            </div>
          </a>
        </li>
        <% end %>
      </ul>
    </div>

    <% if @instagram_scrap[:pictures].present? %>
    <!-- Photos -->
    <div class="section full mt-3 pt-2 pr-2 pl-2 bg-white">
      <div class="row">
        <% @instagram_scrap[:pictures].each do |picture| %>
        <div class="col-4 mb-2">
          <a href="<%= picture[:original] %>" target="_system" onclick="trackProfile(<%= @profile.id %>, <%= Statistic.events[:foto_click] %>);">
            <img src="<%= picture[:thumbnail] %>" alt="image" class="imaged w-100">
          </a>
        </div>
        <% end %>
      </div>
    </div>
    <!-- * Photos -->
    <% end %>

  </div>
  <!-- * App Capsule -->


</body>
